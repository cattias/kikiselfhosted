apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: ceph-critical-alerts
  namespace: monitoring
  labels:
    release: kube-prometheus-stack
spec:
  groups:
  - name: ceph.alerts
    rules:
    - alert: CephClusterHealthDegraded
      # The 'ceph_health_status' metric reports 0 for HEALTH_OK.
      # This expression fires if the status is anything but 0.
      expr: |
        ceph_health_status != 0
      
      # The alert will fire immediately (for: 0m) as soon as the status changes.
      for: 0m
      
      labels:
        severity: critical
        team: storage
        
      annotations:
        summary: "CEPH HEALTH STATUS CHANGE: Cluster is no longer HEALTH_OK"
        description: "The top-level Ceph health metric changed from 0 (OK) to {{ $value }}. Check the Ceph dashboard immediately for specific warnings (e.g., OSDs down, PGs degraded). The change indicates a cluster-wide issue."