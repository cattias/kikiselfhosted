# ceph/kustomization.yaml
# This file chains all the required manifests in the correct order for ArgoCD.
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# 1. Define resources to be applied. ArgoCD/Kustomize applies CRDs first automatically.
resources:
  # The Official Rook Manifests (CRDs, Common, Operator)
  - https://raw.githubusercontent.com/rook/rook/release-1.18/deploy/examples/crds.yaml
  - https://raw.githubusercontent.com/rook/rook/release-1.18/deploy/examples/common.yaml
  - https://raw.githubusercontent.com/rook/rook/release-1.18/deploy/examples/operator.yaml
  - https://raw.githubusercontent.com/rook/rook/release-1.18/deploy/examples/csi-operator.yaml
  # - https://raw.githubusercontent.com/rook/rook/release-1.18/deploy/examples/toolbox.yaml # Optional but useful

# 2. Apply patches
patches:
  - path: operator-patch.yaml # Applies host path mounts to fix Kubelet registration error
    target:
      kind: Deployment
      name: rook-ceph-operator

# 3. Add custom cluster configurations 
resources:
  # Base Rook manifests defined above
  - ceph-base.yaml # Contains CephCluster, CephBlockPool, StorageClass
